<VirtualHost *:80>
    ServerName localhost
    ServerAlias lms.septadenita.my.id
    DocumentRoot /var/www/html

    # Increase timeouts for long-running installation process
    Timeout 600
    ProxyTimeout 600

    # Support for Cloudflare Tunnel / Reverse Proxy
    # Set HTTPS environment variable if X-Forwarded-Proto is https
    # This makes PHP $_SERVER['HTTPS'] available when behind proxy
    SetEnvIf X-Forwarded-Proto "https" HTTPS=on
    SetEnvIf X-Forwarded-Proto "https" SERVER_PORT=443
    
    # Trust proxy headers from Cloudflare Tunnel (runs locally)
    # Cloudflare Tunnel connects from 127.0.0.1 to localhost:1234
    RemoteIPHeader X-Forwarded-For
    RemoteIPTrustedProxy 127.0.0.1
    RemoteIPTrustedProxy ::1
    RemoteIPInternalProxy 127.0.0.1

    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
    </Directory>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    
    # Support for reverse proxy logging
    LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" proxy
    CustomLog ${APACHE_LOG_DIR}/access.log proxy
</VirtualHost>

